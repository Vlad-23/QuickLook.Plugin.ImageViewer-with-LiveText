- name: List Files for Debugging
      run: dir /s # This will show us exactly where the .sln is in the logs

    - name: Restore NuGet Packages
      run: |
        # Search for the solution file specifically
        $sln = Get-ChildItem -Recurse -Filter *.sln | Select-Object -First 1
        if ($null -eq $sln) {
          Write-Error "Could not find a .sln file in the repository!"
          exit 1
        }
        Write-Host "Found solution at: $($sln.FullName)"
        nuget restore "$($sln.FullName)"
        echo "SLN_PATH=$($sln.FullName)" >> $env:GITHUB_ENV

    - name: Build Plugin
      run: |
        # Use the absolute path found above
        # Disabling AssemblyInfo and GitVersion generation to stop the CS2001 error
        msbuild "${{ env.SLN_PATH }}" `
        /p:Configuration=Release `
        /p:Platform="Any CPU" `
        /p:UpdateAssemblyInfo=false `
        /p:GenerateGitVersionInformation=false `
        /p:GetFullMessage=true
