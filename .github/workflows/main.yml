- name: Build
        shell: pwsh
        run: |
          # 1. Create GitVersion.cs at Level 0
          $v = 'using System.Reflection; [assembly: AssemblyVersion("1.0.0.0")]'
          New-Item -Path "workspace/GitVersion.cs" -ItemType File -Value $v -Force

          # 2. Restore EVERYTHING at once
          # This fixes the "assets file not found" for HtmlViewer and Common
          dotnet restore "workspace/ImageViewer/QuickLook.Plugin.ImageViewer.csproj"

          # 3. Build Common (Disabling the failing script)
          echo "Building Common..."
          msbuild "workspace/QuickLook.Common/QuickLook.Common.csproj" `
            /p:Configuration=Release /p:Platform="Any CPU" `
            /p:PreBuildEvent="" /p:PostBuildEvent=""

          # 4. Build HtmlViewer
          echo "Building HtmlViewer..."
          msbuild "workspace/QuickLook.Plugin.HtmlViewer/QuickLook.Plugin.HtmlViewer.csproj" `
            /p:Configuration=Release /p:Platform="Any CPU" `
            /p:PreBuildEvent="" /p:PostBuildEvent=""

          # 5. Build Main Project
          echo "Building Main Project..."
          cd workspace/ImageViewer
          msbuild QuickLook.Plugin.ImageViewer.csproj `
            /p:Configuration=Release `
            /p:Platform="Any CPU" `
            /p:PreBuildEvent="" `
            /p:PostBuildEvent="" `
            /p:GenerateGitVersionInformation=false `
            /p:OutputPath="../../build_output/"
